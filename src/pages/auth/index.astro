---
import { getSession } from "auth-astro/server";
import Auth from "../../components/pages/Auth.astro";
import AppContainer from "../../layouts/AppContainer.astro";
import { singUp } from "../../utils/api/userApi";
import { getI18N } from "../../i18n";
import { setCookie } from "../../utils/cookies/Cookies";

if(Astro.cookies.get("eons_lng")?.value === 'es'){
    console.log('redicteing')
    return Astro.redirect('/es/auth')
 }

 const currentLocale  = Astro?.currentLocale || 'en'
const i18 = getI18N({currentLocale})

const session = await getSession(Astro.request)
  try {
    if(session?.user?.email){
        await singUp({email:session.user.email,password: import.meta.env.AUTH_SECRET})
       .then((response)=>{
         setCookie('eons_user',session.user?.email || '',1)
         setCookie('eons_token',response.data || '',1)
         console.log('redi')
       })
       .catch(({response})=>{console.log(response)})
       return Astro.redirect('/',302)
  }
  } catch (error) {
    console.log(error)
  }
---

<AppContainer>
    <Auth/>
</AppContainer>